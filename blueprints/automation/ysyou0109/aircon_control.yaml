blueprint:
  name: í†µí•© ì—ì–´ì»¨ ìë™í™” (ë¶€ìŠ¤íŠ¸Â·ì¼ë°˜Â·ì œìŠµÂ·ì¢…ë£Œ)
  description: >
    ì´ ë¸”ë£¨í”„ë¦°íŠ¸ëŠ” ê°€ìƒ ìŠ¤ìœ„ì¹˜ì™€ ì‹¤ë‚´ ì˜¨Â·ìŠµë„ ì„¼ì„œ, ê·¸ë¦¬ê³  ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—ì–´ì»¨ì„ ìë™ ì œì–´í•©ë‹ˆë‹¤.
    ë¶€ìŠ¤íŠ¸ ëª¨ë“œ, ì¼ë°˜ ëƒ‰ë°©, ì œìŠµ ë³‘í–‰ ëª¨ë“œ, ì¢…ë£Œ ëª¨ë“œë¥¼ í•˜ë‚˜ë¡œ í†µí•©í•˜ì—¬, ì‚¬ìš©ìì˜ í™˜ê²½ê³¼ ì„¤ì •ê°’ì— ë”°ë¼ ìµœì ì˜ ëƒ‰ë°© ëª¨ë“œë¥¼ ìë™ìœ¼ë¡œ ì„ íƒí•˜ê³  ì „í™˜í•©ë‹ˆë‹¤
  domain: automation
  input:
    climate_entity:
      name: ì—ì–´ì»¨ í´ë¼ì´ë°‹ ì—”í‹°í‹°
      description: ìë™í™”ì— ì‚¬ìš©í•  ì—ì–´ì»¨(CLIMATE) ì—”í‹°í‹°ë¥¼ ì„ íƒí•˜ì„¸ìš”.
      selector:
        entity:
          domain: climate
    input_boolean_switch:
      name: ê°€ìƒ ìŠ¤ìœ„ì¹˜
      description: ì—ì–´ì»¨ ìƒíƒœë¥¼ ì¶”ì í•˜ê³ , ì—ì–´ì»¨ì„ ì¼œê±°ë‚˜ ëŒ ìˆ˜ ìˆë„ë¡ ì œì–´í•˜ëŠ” ê°€ìƒ ìŠ¤ìœ„ì¹˜ì…ë‹ˆë‹¤.
      selector:
        entity:
          domain: input_boolean
    input_time_tracker:
      name: ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ì¼œì§„ ì‹œê°„ ê¸°ë¡
      description: ë¶ˆì¾Œì§€ìˆ˜ ëª¨ë“œê°€ ì¼œì§„ ì´í›„ ê²½ê³¼ ì‹œê°„ì„ ê¸°ë¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ ë°œìƒ ì‹œ 20ë¶„ì´ ê²½ê³¼í•˜ë©´ ëª¨ë“œë¥¼ ì¢…ë£Œ í›„ ìë™ ì¬ì‹œì‘í•©ë‹ˆë‹¤.
      selector:
        entity:
          domain: input_datetime
    temperature_sensor:
      name: ì‹¤ë‚´ ì˜¨ë„ ì„¼ì„œ
      selector:
        entity:
          domain: sensor
          device_class: temperature
    humidity_sensor:
      name: ì‹¤ë‚´ ìŠµë„ ì„¼ì„œ
      selector:
        entity:
          domain: sensor
          device_class: humidity
    input_number_boost_threshold:
      name: ë¶€ìŠ¤íŠ¸ ëª¨ë“œ ì§„ì… ê¸°ì¤€ ì˜¨ë„ (Â°C)
      description: í˜„ì¬ ì˜¨ë„ê°€ ì´ ê°’ë³´ë‹¤ ë†’ìœ¼ë©´ ë¶€ìŠ¤íŠ¸ ëª¨ë“œê°€ ì‘ë™í•©ë‹ˆë‹¤.
      default: 24
      selector:
        number:
          min: 20
          max: 30
          unit_of_measurement: "Â°C"
          mode: slider
    boost_aircon_fan_mode:
      name: ë¶€ìŠ¤íŠ¸ëª¨ë“œ íŒ¬ì„¤ì •
      description: ì—ì–´ì»¨ë§ˆë‹¤ ì§€ì›í•˜ëŠ” ê°’ì´ ë‹¤ë¥´ë¯€ë¡œ ì—ì–´ì»¨ì˜ fan_modes ì†ì„±ì„ ì°¸ê³ í•˜ì—¬ ì…ë ¥í•©ë‹ˆë‹¤. (auto, low, medium,
        high, turbo, middle, ...)
      default: POWER
      selector:
        text: {}
    input_number_boost_duration:
      name: ë¶€ìŠ¤íŠ¸ ëª¨ë“œ ì§€ì† ì‹œê°„ (ë¶„),
      description:  ë¶€ìŠ¤íŠ¸ ëª¨ë“œì˜ ì§€ì† ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤. 0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë¶€ìŠ¤íŠ¸ ëª¨ë“œê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
      default: 10
      selector:
        number:
          min: 0
          max: 60
          unit_of_measurement: ë¶„
          mode: slider
    input_boost_mode:
      name: ë¶€ìŠ¤íŠ¸ëª¨ë“œ ìƒíƒœí™•ì¸ìš©
      selector:
        entity:
          domain: input_boolean
    input_number_dehumid_threshold:
      name: ì œìŠµ ë³‘í–‰ ê¸°ì¤€ ìŠµë„ (%)
      description: í˜„ì¬ ìŠµë„ê°€ ì´ ê°’ë³´ë‹¤ ë†’ìœ¼ë©´ ì œìŠµ ê¸°ëŠ¥ì´ ìš°ì„  ì‹¤í–‰ë©ë‹ˆë‹¤.
      selector:
        entity:
          domain: input_number
    input_dry_mode:
      name: ì œìŠµëª¨ë“œ ìƒíƒœí™•ì¸ìš©
      selector:
        entity:
          domain: input_boolean
    input_number_general_temperature:
      name: ì¼ë°˜ëƒ‰ë°© ëª¨ë“œ ì„¤ì • ì˜¨ë„ (Â°C)
      description: ì¼ë°˜ ëƒ‰ë°© ëª¨ë“œì—ì„œ ì‚¬ìš©í•  ì„¤ì • ì˜¨ë„ì…ë‹ˆë‹¤.
      default: 23
      selector:
        number:
          min: 20
          max: 25
          unit_of_measurement: "Â°C"
          mode: slider
          
    input_number_now_discomfort:
      name: í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜
      description: í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í…œí”Œë¦¿ ì„¼ì„œì…ë‹ˆë‹¤.(DI)
      selector:
        entity:
          domain: sensor
    input_number_target_discomfort:
      name: ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜
      description: >
        ì‚¬ìš©ìê°€ ì¾Œì í•˜ê²Œ ëŠë¼ëŠ” ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
        (ì˜ˆ: 68 ì´í•˜ ì¾Œì , 68â€“73 ì•½ê°„ ë¶ˆì¾Œ, 73â€“77 ë¶ˆì¾Œê° ì‹œì‘)
      selector:
        entity:
          domain: input_number
    input_number_tolerance:
      name: ë¶ˆì¾Œì§€ìˆ˜ í—ˆìš© ì˜¤ì°¨
      description: ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜ì— ëŒ€í•œ í—ˆìš© ë²”ìœ„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜¤ì°¨ ë²”ìœ„ ë°–ì¼ ê²½ìš° ëª¨ë“œê°€ ì „í™˜ë©ë‹ˆë‹¤.
      default: 0.1
      selector:
        number:
          min: 0.0
          max: 1.0
          step: 0.1
          mode: slider
    input_index_mode:
      name: ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ìƒíƒœí™•ì¸ìš©
      selector:
        entity:
          domain: input_boolean
    high_aircon_fan_mode:
      name: ê°•ë ¥ ëƒ‰ë°©ëª¨ë“œ íŒ¬ì„¤ì •
      description: >
        ì œìŠµëª¨ë“œ, ë¶ˆì¾Œì§€ìˆ˜ ë†’ì„ë•Œ ì¢…ë£Œ ëª¨ë“œì—ì„œ ì‚¬ìš©ë  fan_mode ì„¤ì •ê°’ì„ ì ì–´ì£¼ì„¸ìš”
        ë¹ ë¥´ê²Œ ì˜¨ë„ ë³€í™”ê°€ í•„ìš”í•´ ë˜ë„ë¡ high ì¶”ì²œë“œë¦¬ê³  í•„ìš”ì— ë”°ë¼ ë‹¤ë¥¸ê°’ ì‚¬ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.
      default: high
      selector:
        text: {}
    general_aircon_fan_mode:
      name: ì¼ë°˜ëƒ‰ë°©ëª¨ë“œ íŒ¬ì„¤ì •
      description: >
        ë¶ˆì¾Œì§€ìˆ˜ê°€ ì ì •í•˜ê±°ë‚˜ ë‚®ì„ë•Œ ì‚¬ìš©í•  íŒ¬ëª¨ë“œ ì…ë ¥í•´ì£¼ì„¸ìš”
        (SLOW_LOW,low,medimu,high,auto..ìì‹ ì˜ ê¸°ê¸°ì— ë§ê²Œ)
      default: auto
      selector:
        text: {}
    input_number_shutdown_delay:
      name: ì¢…ë£Œ ëª¨ë“œ ì†¡í’ ìœ ì§€ ì‹œê°„ (ë¶„)
      description: >
        ì—ì–´ì»¨ì´ êº¼ì§„ í›„ ì†¡í’ì„ ìœ ì§€í•  ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤. 0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì¢…ë£Œ ëª¨ë“œê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
        (ë¹„í™œì„±í™” ì‹œ ì—ì–´ì»¨ ìì²´ì˜ ê±´ì¡°ê¸°ëŠ¥ì´ ì‘ë™í• ì§€ ì•ˆí• ì§€ëŠ” ê¸°ì¡´ì—ì–´ì»¨ì˜ ì„¤ì •ì—ë”°ë¼ ë‹¤ë¦„.)
      default: 30
      selector:
        number:
          min: 0
          max: 120
          unit_of_measurement: ë¶„
          mode: slider
    input_end_mode:
      name: ì¢…ë£Œëª¨ë“œ ì‘ë™ëŒ€ê¸°ì¤‘
      description: >
        ì—ì–´ì»¨ì´ ì‘ë™ í›„ 10ë¶„ì´ ì§€ë‚˜ë©´ ì¢…ë£Œ ëª¨ë“œ ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜ë˜ë©°, ì—ì–´ì»¨ ì¢…ë£Œ ì‹œ ì†¡í’ ìœ ì§€ í›„ ì™„ì „íˆ êº¼ì§€ë„ë¡ ì„¤ì •ë©ë‹ˆë‹¤. 
        (ë‹¨, ì—ì–´ì»¨ìì²´ì˜ ê±´ì¡°ì‹œê°„ê³¼ ì¤‘ë³µ ì‹¤í–‰ë ìˆ˜ìˆìŠµë‹ˆë‹¤.) 
      selector:
        entity:
          domain: input_boolean
    input_end_mode_now:
      name: ì¢…ë£Œëª¨ë“œ ì‘ë™ì¤‘
      selector:
        entity:
          domain: input_boolean
    input_log:
      name: ë¡œê·¸ ì €ì¥ìš©
      description: ì—ì–´ì»¨ ìë™í™”ì˜ ì‘ë™ ìƒíƒœ ë° ë³€ê²½ ë‚´ìš©ì„ ì €ì¥í•˜ëŠ” ë¡œê·¸ì…ë‹ˆë‹¤..
      selector:
        entity:
          domain: input_text


trigger:
  - platform: state
    id: switch_on
    entity_id: !input input_boolean_switch
    from: "off"
    to: "on"
  - platform: state
    id: switch_off
    entity_id: !input input_boolean_switch
    from: "on"
    to: "off"
  - platform: state
    id: ac_on
    entity_id: !input climate_entity
    from: "off"
    to:
      - "cool"
      - "dry"
  - platform: state
    id: fan_on
    entity_id: !input climate_entity
    from: "off"
    to:
      - "fan_only"
  - platform: state
    id: ac_off
    entity_id: !input climate_entity
    to: "off"
  - platform: state
    id: discomfort_change
    entity_id:

      - !input input_number_now_discomfort
      - !input input_number_target_discomfort
      - !input input_number_dehumid_threshold
  - platform: state
    id: index_on
    entity_id: !input input_index_mode
    from: "off"
    to: "on"
  - platform: state
    id: over_time
    entity_id: !input input_index_mode
    to: "off"
    for: "00:05:00"
  - platform: time_pattern
    id: time_change
    minutes: "/1"
    
action:
  - variables:
  #íŠ¸ë¦¬ê±°ìŠ¤ìœ„ì¹˜
      ac: !input climate_entity
      sw: !input input_boolean_switch
      
      temp_s: !input temperature_sensor
      hum_s: !input humidity_sensor
      gen_t: !input input_number_general_temperature
      boost_thr: !input input_number_boost_threshold
      boost_dur: !input input_number_boost_duration
      boost_fan: !input boost_aircon_fan_mode

      dehum_thr: !input input_number_dehumid_threshold
      tol: !input input_number_tolerance
      n_idx: !input input_number_now_discomfort
      tgt_idx: !input input_number_target_discomfort
      
      idx_mode: !input input_index_mode
      gen_fan_mode: !input general_aircon_fan_mode
      high_fan_mode: !input high_aircon_fan_mode

      shut_delay: !input input_number_shutdown_delay
      
      

      dehumidity: "{{ states[dehum_thr].state | float(0) }}"
      temperature: "{{ states[temp_s].state | float(0) }}"
      humidity: "{{ states[hum_s].state | float(0) }}"
      discomfort_index: "{{ states[n_idx].state | float(0) }}"
      target_discomfort: "{{ states[tgt_idx].state   | float(0) }}"
      time_tra: !input input_time_tracker
      shut_delay_time: "{{ shut_delay | float(0)}}"

  - choose:
      # 1) ê°€ìƒ ìŠ¤ìœ„ì¹˜ ON
      - conditions:
          - condition: trigger
            id: switch_on
        sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boost_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode_now
          - delay: "00:00:01"
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
          - delay: "00:00:01"
          - service: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input input_number_general_temperature
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input input_number_boost_threshold
                  - condition: template
                    value_template: >
                       {{ 0 < boost_dur}}
                sequence:
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: 18
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ boost_fan }}'
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_boost_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸš€ë¶€ìŠ¤íŠ¸ëª¨ë“œ({{ boost_dur }}ë¶„)
                        ì˜¨ë„: {{ temperature }}â„ƒ ìŠµë„ : {{ humidity }}â„ƒ  ê¸°ì¤€ :{{ boost_thr }}  
                        ì§€ìˆ˜: {{ discomfort_index }}
                  - delay:
                      minutes: !input input_number_boost_duration
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: '{{ gen_fan_mode }}'
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} | OFF ğŸ“´ë¶€ìŠ¤íŠ¸ëª¨ë“œ 
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                                ì§€ìˆ˜: {{ discomfort_index }}

            default:
                - service: climate.set_hvac_mode
                  target:
                     entity_id: !input climate_entity
                  data:
                    hvac_mode: cool
                - service: climate.set_temperature
                  target:
                    entity_id: !input climate_entity
                  data:
                    temperature: !input input_number_general_temperature
                - delay: "00:00:01"
                - service: climate.set_fan_mode
                  target:
                    entity_id: !input climate_entity
                  data:
                    fan_mode: '{{ gen_fan_mode }}'
                - delay : "00:10:00"
                - service: input_boolean.turn_on
                  target:
                    entity_id: !input input_end_mode

      # 2) ì—ì–´ì»¨ ON (ì§ì ‘ ì¼œì§ ê°ì§€)
      - conditions:
          - condition: trigger
            id: ac_on
          - condition: state
            entity_id: !input input_boolean_switch
            state: "off"
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: !input input_boolean_switch
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boost_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_dry_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode_now
          - delay: "00:00:01"
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
          - delay: "00:00:01"
          - service: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input input_number_general_temperature
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input input_number_boost_threshold
                  - condition: template
                    value_template: >
                       {{ 0 < boost_dur}}
                sequence:
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: 18
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ boost_fan }}'
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_boost_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸš€ë¶€ìŠ¤íŠ¸ëª¨ë“œ({{ boost_dur }}ë¶„)
                        ì˜¨ë„: {{ temperature }}â„ƒ ìŠµë„ : {{ humidity }}â„ƒ  ê¸°ì¤€ :{{ boost_thr }}
                        ì§€ìˆ˜: {{ discomfort_index }}
                  - delay:
                      minutes: !input input_number_boost_duration
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: '{{ gen_fan_mode }}'
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} | OFF ğŸ“´ë¶€ìŠ¤íŠ¸ëª¨ë“œ 
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                                ì§€ìˆ˜: {{ discomfort_index }}
            default:
                - service: climate.set_hvac_mode
                  target:
                     entity_id: !input climate_entity
                  data:
                    hvac_mode: cool
                - service: climate.set_temperature
                  target:
                    entity_id: !input climate_entity
                  data:
                    temperature: !input input_number_general_temperature
                - delay: "00:00:01"
                - service: climate.set_fan_mode
                  target:
                    entity_id: !input climate_entity
                  data:
                    fan_mode: '{{ gen_fan_mode }}'
                - delay : "00:10:00"
                - service: input_boolean.turn_on
                  target:
                    entity_id: !input input_end_mode

                
      # 3) ì†¡í’ ON (ì§ì ‘ ì¼œì§ ê°ì§€)
      - conditions:
          - condition: trigger
            id: fan_on
          - condition: state
            entity_id: !input input_boolean_switch
            state: "off"
          - condition: state
            entity_id: !input input_end_mode
            state: "off"
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: !input input_boolean_switch
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boost_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_dry_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode
          - delay: "00:00:01"
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
          - delay: "00:00:01"
          - service: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input input_number_general_temperature
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input input_number_boost_threshold
                  - condition: template
                    value_template: >
                       {{ 0 < boost_dur}}
                sequence:
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: 18
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ boost_fan }}'
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_boost_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸš€ë¶€ìŠ¤íŠ¸ëª¨ë“œ({{ boost_dur }}ë¶„)
                        ì˜¨ë„: {{ temperature }}â„ƒ ìŠµë„ : {{ humidity }}â„ƒ  ê¸°ì¤€ :{{ boost_thr }}
                        ì§€ìˆ˜: {{ discomfort_index }}
                  - delay:
                      minutes: !input input_number_boost_duration
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: '{{ gen_fan_mode }}'
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} | OFF ğŸ“´ë¶€ìŠ¤íŠ¸ëª¨ë“œ 
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                                ì§€ìˆ˜: {{ discomfort_index }}
            default:
                - service: climate.set_hvac_mode
                  target:
                     entity_id: !input climate_entity
                  data:
                    hvac_mode: cool
                - service: climate.set_temperature
                  target:
                    entity_id: !input climate_entity
                  data:
                    temperature: !input input_number_general_temperature
                - delay: "00:00:01"
                - service: climate.set_fan_mode
                  target:
                    entity_id: !input climate_entity
                  data:
                    fan_mode: '{{ gen_fan_mode }}'
                - delay : "00:10:00"
                - service: input_boolean.turn_on
                  target:
                    entity_id: !input input_end_mode


  - choose:
      # 4. index_on íŠ¸ë¦¬ê±° ì‹œ ì‹œê°„ ì €ì¥
      - conditions:
          - condition: trigger
            id: index_on
        sequence:
          - service: input_datetime.set_datetime
            target:
              entity_id: !input input_time_tracker
            data:
              datetime: "{{ now().isoformat() }}"

      # 4-1. 1ë¶„ë§ˆë‹¤ í™•ì¸í•´ì„œ êº¼ì§€ê¸°
      - conditions:
          - condition: trigger
            id: time_change
          - condition: state
            entity_id: !input input_index_mode
            state: "on"
          - condition: template
            value_template: >
              {% set on_time = states[time_tra].state %}
              {% if on_time in ['unknown', 'unavailable', None] %}
                false
              {% else %}
                {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 1200 }}
              {% endif %}
        sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_text.set_value
            target:
              entity_id: !input input_log
            data:
              value: >
                {{ now().strftime('%m-%d %H:%M') }} ++ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ì‘ë™ 20ë¶„ê²½ê³¼ë˜ì–´ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.++


      # 5) ë¶ˆì¾Œì§€ìˆ˜Â·ìŠµë„ ë³€í™”
      - conditions:
          - condition: or
            conditions:
              - condition: trigger
                id: discomfort_change
              - condition: trigger
                id: over_time
          - condition: state
            entity_id: !input input_boolean_switch
            state: "on"
          - condition: state
            entity_id: !input input_boost_mode
            state: "off"
          - condition: state
            entity_id: !input input_index_mode
            state: "off"
          - condition: state
            entity_id: !input input_dry_mode
            state: "off"
          - condition: state
            entity_id: !input input_end_mode_now
            state: "off"
          - condition: template
            value_template: >
              {% set on_time = states[time_tra].state %}
              {% if on_time in ['unknown', 'unavailable', None] %}
                false
              {% else %}
                {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 600 }}
              {% endif %}
        sequence:
          - choose:
              #5-1 ì œìŠµ ë³‘í–‰ ì œìŠµ 10ë¶„+ëƒ‰ë°©5ë¶„
              - conditions:
                  - condition: numeric_state
                    entity_id: !input humidity_sensor
                    above: !input input_number_dehumid_threshold
                sequence:
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_dry_mode
                  - delay: "00:00:01"
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: dry
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ boost_fan }}'
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸ’§ì œìŠµëª¨ë“œ 10ë¶„)
                        ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}% (ê¸°ì¤€: {{ dehumidity }}%)
                  - delay: "00:10:00"
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                          - condition: template
                            value_template: >
                              {% set on_time = states[time_tra].state %}
                              {% if on_time in ['unknown', 'unavailable', None] %}
                                false
                              {% else %}
                                {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 500 }}
                              {% endif %}
                        sequence:
                          - service: climate.set_hvac_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              hvac_mode: cool
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: '{{ gen_fan_mode }}'
                          - delay: "00:00:01"
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - delay: "00:05:00"
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_dry_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} | OFF ğŸ”ì œìŠµëª¨ë“œ
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}% (ê¸°ì¤€: {{ dehumidity }}%)



              # 5-2 ë¶ˆì¾Œì§€ìˆ˜ ë†’ìŒ â†’ ëƒ‰ë°©10ë¶„
              - conditions:
                  - condition: template
                    value_template: >
                      {{ discomfort_index > (target_discomfort + tol) }}
                  
                sequence:
                  - delay: "00:00:01"
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_index_mode
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: cool
                  - delay: "00:00:01"
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: !input input_number_general_temperature
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ boost_fan }}'
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸŒ¡ì§€ìˆ˜ë†’ìŒ(ëƒ‰ë°©10ë¶„) ï¸
                        ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                        ì§€ìˆ˜: {{ discomfort_index }} > ëª©í‘œ: {{ target_discomfort }} (+{{ tol }})

                  - delay: "00:10:00"
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                          - condition: template
                            value_template: >
                              {% set on_time = states[time_tra].state %}
                              {% if on_time in ['unknown', 'unavailable', None] %}
                                false
                              {% else %}
                                {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 500 }}
                              {% endif %}
                        sequence:
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} | OFF ğŸ“´ì§€ìˆ˜ë†’ìŒ
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                                ì§€ìˆ˜: {{ discomfort_index }} / ëª©í‘œ: {{ target_discomfort }}
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_index_mode


              # 5-3 ë¶ˆì¾Œì§€ìˆ˜ ë‚®ìŒ â†’ ì†¡í’10ë¶„ 
              - conditions:
                  - condition: template
                    value_template: >
                      {{ discomfort_index < (target_discomfort - tol) }}
                sequence:
                  - delay: "00:00:01"
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_index_mode
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: fan_only
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ gen_fan_mode }}'
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸƒì§€ìˆ˜ë‚®ìŒ(ì†¡í’10ë¶„)
                        ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                        ì§€ìˆ˜: {{ discomfort_index }} < ëª©í‘œ: {{ target_discomfort }} (-{{ tol }})

                  - delay: "00:10:00"
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                          - condition: template
                            value_template: >
                              {% set on_time = states[time_tra].state %}
                              {% if on_time in ['unknown', 'unavailable', None] %}
                                false
                              {% else %}
                                {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 500 }}
                              {% endif %}
                        sequence:
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_index_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} | OFF ğŸ“´ì§€ìˆ˜ë‚®ìŒ
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                                ì§€ìˆ˜: {{ discomfort_index }} / ëª©í‘œ: {{ target_discomfort }}

                          
                  
             # 5-4 ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜ ë²”ìœ„ë‚´ ì†¡í’ 10+ëƒ‰ë°©5
              - conditions:
                  - condition: state
                    entity_id: !input input_boolean_switch
                    state: "on"
                sequence:
                  - delay: "00:00:01"
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_index_mode
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: fan_only
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ gen_fan_mode }}'
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON âš–ï¸ì§€ìˆ˜ì ì •(ì†¡í’10ë¶„ ëƒ‰ë°©5ë¶„) 
                        ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                        ì§€ìˆ˜: {{ discomfort_index }} â‰ˆ ëª©í‘œ: {{ target_discomfort }}
                  - delay: "00:10:00"
                  - choose:
                    - conditions:
                        - condition: state
                          entity_id: !input input_boolean_switch
                          state: "on"
                        - condition: template
                          value_template: >
                            {% set on_time = states[time_tra].state %}
                            {% if on_time in ['unknown', 'unavailable', None] %}
                              false
                            {% else %}
                              {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 500 }}
                            {% endif %}
                      sequence:
                        - service: climate.set_hvac_mode
                          target:
                            entity_id: !input climate_entity
                          data:
                            hvac_mode: cool
                        - delay: "00:00:01"
                        - service: climate.set_temperature
                          target:
                            entity_id: !input climate_entity
                          data:
                            temperature: !input input_number_general_temperature
                        - delay: "00:00:01"
                        - service: climate.set_fan_mode
                          target:
                            entity_id: !input climate_entity
                          data:
                            fan_mode: '{{ gen_fan_mode }}'
                        - delay: "00:05:00"
                        - choose:
                          - conditions:
                              - condition: state
                                entity_id: !input input_boolean_switch
                                state: "on"
                            sequence:
                              - service: input_boolean.turn_off
                                target:
                                  entity_id: !input input_index_mode
                              - service: input_boolean.turn_on
                                target:
                                  entity_id: !input input_end_mode
                              - service: input_text.set_value
                                target:
                                  entity_id: !input input_log
                                data:
                                  value: >
                                    {{ now().strftime('%m-%d %H:%M') }} | OFF âœ…ì§€ìˆ˜ì ì • 
                                    ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%
                                    ì§€ìˆ˜: {{ discomfort_index }} / ëª©í‘œ: {{ target_discomfort }}



      # 6) ì—ì–´ì»¨ OFF ê°ì§€ â†’ ìŠ¤ìœ„ì¹˜ ë™ê¸°í™” â†’ #7
      - conditions:
          - condition: trigger
            id: ac_off
        sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boolean_switch




      # 7 ê°€ìƒ ìŠ¤ìœ„ì¹˜ OFF â†’ ì†¡í’ í›„ ì¢…ë£Œ
      - conditions:
          - condition: trigger
            id: switch_off
        sequence:
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: state
                    entity_id: !input input_end_mode
                    state: "on"
                  - condition: state
                    entity_id: !input input_end_mode_now
                    state: "off"
                  - condition: template
                    value_template: >
                       {{ 0 < shut_delay }}
                sequence:
                  - delay: "00:00:01"
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: fan_only
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: '{{ boost_fan }}'
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_end_mode_now
                  - service: input_boolean.turn_off
                    target:
                      entity_id: !input input_index_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} | ON ğŸ›‘ì¢…ë£Œëª¨ë“œ {{ shut_delay_time }} ë¶„
                        ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%

                  - delay:
                      minutes: !input input_number_shutdown_delay
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "off"
                        sequence:
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_index_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_dry_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_end_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_end_mode_now
                          - delay: '00:00:01'
                          - service: climate.turn_off
                            target:
                              entity_id: !input climate_entity
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} |ğŸ›‘ì‹œìŠ¤í…œì¢…ë£Œ 
                                ì‹œìŠ¤í…œì„ ì™„ì „íˆ ì¢…ë£Œí•©ë‹ˆë‹¤.
                                ì˜¨ë„: {{ temperature }}â„ƒ / ìŠµë„: {{ humidity }}%


            default:
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_boolean_switch
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_index_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_boost_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_dry_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_end_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_end_mode_now
                - delay: "00:00:01"
                - service: climate.turn_off
                  target:
                    entity_id: !input climate_entity
                - service: input_text.set_value
                  target:
                    entity_id: !input input_log
                  data:
                    value: >
                      {{ now().strftime('%m-%d %H:%M') }} ì¢…ë£Œëª¨ë“œì‘ë™í•˜ì§€ ì•ŠìŒ |ğŸ›‘ì‹œìŠ¤í…œì¢…ë£Œ ì˜¨ë„:{{ temperature }}/ìŠµë„:{{ humidity }}



                  
                  
                  
mode: parallel
