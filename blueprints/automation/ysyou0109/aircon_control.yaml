blueprint:
  name: í†µí•© ì—ì–´ì»¨ ìë™í™” (ë¶€ìŠ¤íŠ¸Â·ì¼ë°˜Â·ì œìŠµÂ·ì¢…ë£Œ)
  description: >
    ê°€ìƒ ìŠ¤ìœ„ì¹˜, ì‹¤ë‚´ ì˜¨Â·ìŠµë„ ì„¼ì„œ, ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜ ë“±ì„ ì´ìš©í•´
    ë¶€ìŠ¤íŠ¸ ëª¨ë“œ, ì¼ë°˜ ëª¨ë“œ, ì œìŠµ ë³‘í–‰ ëª¨ë“œ, ì¢…ë£Œ ëª¨ë“œë¥¼ í•˜ë‚˜ì˜ ë¸”ë£¨í”„ë¦°íŠ¸ë¡œ í†µí•©í•©ë‹ˆë‹¤.
  domain: automation
  input:
    climate_entity:
      name: ì—ì–´ì»¨ í´ë¼ì´ë°‹ ì—”í‹°í‹°
      description: ì‘ë™í•  ì—ì–´ì»¨ì˜ CLIMATEë¥¼ ì§€ì •
      selector:
        entity:
          domain: climate
    input_boolean_switch:
      name: ê°€ìƒ ìŠ¤ìœ„ì¹˜
      description: ì—ì–´ì»¨ê³¼ ì—°ë™í•˜ì—¬ ì—ì–´ì»¨ì˜ ì‘ë™ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì—ì–´ì»¨ on/offëª…ë ¹ì„ ë‚´ë¦¬ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰
      selector:
        entity:
          domain: input_boolean
    input_time_tracker:
      name: ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ì¼œì§„ ì‹œê°„ ê¸°ë¡
      description: ë¶ˆì¾Œì§€ìˆ˜ ëª¨ë“œê°€ ì¼œì§„ìƒíƒœì—ì„œ ì–´ë–¤ì˜¤ë¥˜ê°€ ë°œìƒí• ê²½ìš° ëŒ€ë¹„ìš© í˜„ì¬ì‹œê°„ê³¼ ë¹„êµí•˜ì—¬ 20ë¶„ì´ë„˜ìœ¼ë©´ ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ì¢…ë£Œë˜ê³  ë‹¤ì‹œì‘ë™ë¨ë¨
      selector:
        entity:
          domain: input_datetime
    temperature_sensor:
      name: ì‹¤ë‚´ ì˜¨ë„ ì„¼ì„œ
      selector:
        entity:
          domain: sensor
          device_class: temperature
    humidity_sensor:
      name: ì‹¤ë‚´ ìŠµë„ ì„¼ì„œ
      selector:
        entity:
          domain: sensor
          device_class: humidity
    input_number_boost_threshold:
      name: ë¶€ìŠ¤íŠ¸ ëª¨ë“œ ì§„ì… ê¸°ì¤€ ì˜¨ë„ (Â°C)
      description: ì„¤ì •í•œ ì˜¨ë„ë³´ë‹¤ í˜„ì¬ì˜¨ë„ê°€ ë†’ìœ¼ë©´ ë¶€ìŠ¤íŠ¸ ëª¨ë“œ ì‘ë™í•©ë‹ˆë‹¤.
      default: 24
      selector:
        number:
          min: 20
          max: 30
          unit_of_measurement: "Â°C"
          mode: slider
    input_number_boost_duration:
      name: ë¶€ìŠ¤íŠ¸ ëª¨ë“œ ì§€ì† ì‹œê°„ (ë¶„),
      description:  0ìœ¼ë¡œ ì„¤ì •ë˜ë©´ ë¶€ìŠ¤íŠ¸ëª¨ë“œ ë¹„í™œì„±í™”
      default: 10
      selector:
        number:
          min: 0
          max: 60
          unit_of_measurement: ë¶„
          mode: slider
    input_boost_mode:
      name: ë¶€ìŠ¤íŠ¸ëª¨ë“œ ìƒíƒœí™•ì¸ìš©
      selector:
        entity:
          domain: input_boolean


    input_number_dehumid_threshold:
      name: ì œìŠµ ë³‘í–‰ ê¸°ì¤€ ìŠµë„ (%)
      description: ì„¤ì •ìŠµë„ë³´ë‹¤ ë†’ì„ê²½ìš° ì œìŠµê¸°ëŠ¥ì„ìš°ì„ í•©ë‹ˆë‹¤.
      selector:
        entity:
          domain: input_number
    input_dry_mode:
      name: ì œìŠµëª¨ë“œ ìƒíƒœí™•ì¸ìš©
      selector:
        entity:
          domain: input_boolean
    input_number_general_temperature:
      name: ì¼ë°˜ëƒ‰ë°© ëª¨ë“œ ì„¤ì • ì˜¨ë„ (Â°C)
      default: 23
      selector:
        number:
          min: 20
          max: 25
          unit_of_measurement: "Â°C"
          mode: slider
          
    input_number_now_discomfort:
      name: í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜
      description: í…œí”Œë¦¿ì„¼ì„œë¡œ ê³„ì‚°ëœ í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜(DI)
      selector:
        entity:
          domain: sensor
    input_number_target_discomfort:
      name: ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜
      description: ë‚´ê°€ ì›í•˜ëŠ” ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜(68 ì´í•˜ ì¾Œì , 68â€“73 ì•½ê°„ ë¶ˆì¾Œ, 73â€“77 ë¶ˆì¾Œê° ì‹œì‘)
      selector:
        entity:
          domain: input_number
    input_number_tolerance:
      name: ë¶ˆì¾Œì§€ìˆ˜ í—ˆìš© ì˜¤ì°¨
      description: ëª©í‘œë¶ˆì¾Œì§€ìˆ˜ì˜ ìƒí•˜ ì˜¤ì°¨- ëª©í‘œì˜¤ì°¨ë²”ìœ„ë³´ë‹¤ ìœ„ì¸ì§€ ì•„ë˜ì¸ì§€ì— ë”°ë¼ ì‘ë™ì´ ë°”ë€ë‹ˆë‹¤.
      default: 0.1
      selector:
        number:
          min: 0.0
          max: 1.0
          step: 0.1
          mode: slider
    input_index_mode:
      name: ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ìƒíƒœí™•ì¸ìš©
      selector:
        entity:
          domain: input_boolean

    input_number_shutdown_delay:
      name: ì¢…ë£Œ ëª¨ë“œ ì†¡í’ ìœ ì§€ ì‹œê°„ (ë¶„)
      description: ë§Œì•½ ì—ì–´ì»¨ì˜ ìì²´ ê±´ì¡°ê¸°ëŠ¥ê³¼ ì¤‘ë³µëœë‹¤ë©´ ì†¡í’ìœ ì§€ ì‹œê°„ì„ ì¤„ì´ì„¸ìš” "0" ìœ¼ë¡œ í•´ë‘ë©´ ê¸°ëŠ¥ ë¹„í™œì„±í™”(ì—ì–´ì»¨ ìì²´ì˜ ê±´ì¡°ê¸°ëŠ¥ì´ ì‘ë™í• ì§€ ì•ˆí• ì§€ëŠ” ê¸°ì¡´ì—ì–´ì»¨ì˜ ì„¤ì •ì—ë”°ë¼ ë‹¤ë¦„.)
      default: 30
      selector:
        number:
          min: 0
          max: 120
          unit_of_measurement: ë¶„
          mode: slider
    input_end_mode:
      name: ì¢…ë£Œëª¨ë“œ ì‘ë™ëŒ€ê¸°ì¤‘
      description: ì—ì–´ì»¨ì´ ì¼œì§€ê³  10ë¶„ì´ ì§€ë‚˜ë©´ ì¼œì§€ê³  ì—ì–´ì»¨ì´ ì¢…ë£Œë˜ë©´ ì†¡í’ ìœ ì§€ì‹œê°„ë™ì•ˆ ì‘ë™ë˜ê³  ì—ì–´ì»¨ì´ êº¼ì§‘ë‹ˆë‹¤. (ë‹¨, ì—ì–´ì»¨ìì²´ì˜ ê±´ì¡°ì‹œê°„ê³¼ ì¤‘ë³µ ì‹¤í–‰ë ìˆ˜ìˆìŠµë‹ˆë‹¤.) ë˜í•œ, ì¢…ë£Œëª¨ë“œê°€ ì‘ë™ì¤‘ HAê°€ ì¬ì‹œì‘í•˜ê±°ë‚˜ yamlì„ ë‹¤ì‹œì½ì–´ì˜¤ë©´ ìë™ì¢…ë£Œê°€ ë˜ì§€ì•Šì„ìˆ˜ìˆìŠµë‹ˆë‹¤.
      selector:
        entity:
          domain: input_boolean
    input_end_mode_now:
      name: ì¢…ë£Œëª¨ë“œ ì‘ë™ì¤‘
      selector:
        entity:
          domain: input_boolean
    input_log:
      name: ë¡œê·¸ ì €ì¥ìš©
      description: ì‘ë™ìƒíƒœë¥¼ ì €ì¥í•˜ê¸°ìœ„í•œ ë¡œê·¸ì…ë‹ˆë‹¤.
      selector:
        entity:
          domain: input_text


trigger:
  - platform: state
    id: switch_on
    entity_id: !input input_boolean_switch
    from: "off"
    to: "on"
  - platform: state
    id: switch_off
    entity_id: !input input_boolean_switch
    from: "on"
    to: "off"
  - platform: state
    id: ac_on
    entity_id: !input climate_entity
    from: "off"
    to:
      - "cool"
      - "dry"
  - platform: state
    id: fan_on
    entity_id: !input climate_entity
    from: "off"
    to:
      - "fan_only"
  - platform: state
    id: ac_off
    entity_id: !input climate_entity
    to: "off"
  - platform: state
    id: discomfort_change
    entity_id:
      - !input temperature_sensor
      - !input humidity_sensor
      - !input input_number_now_discomfort
      - !input input_number_target_discomfort
      - !input input_number_dehumid_threshold
  - platform: state
    id: index_on
    entity_id: !input input_index_mode
    from: "off"
    to: "on"
  - platform: state
    id: over_time
    entity_id: !input input_index_mode
    to: "off"
    for: "00:05:00"
  - platform: time_pattern
    id: time_change
    minutes: "/1"
    
action:
  - variables:
      ac: !input climate_entity
      sw: !input input_boolean_switch
      temp_s: !input temperature_sensor
      hum_s: !input humidity_sensor
      gen_t: !input input_number_general_temperature
      boost_thr: !input input_number_boost_threshold
      boost_dur: !input input_number_boost_duration
      dehum_thr: !input input_number_dehumid_threshold
      tol: !input input_number_tolerance
      n_idx: !input input_number_now_discomfort
      tgt_idx: !input input_number_target_discomfort
      end_mode: !input input_end_mode
      shut_delay: !input input_number_shutdown_delay
      boosttemp: "{{ states[dehum_thr].state | float(0) }}"
      dehumidity: "{{ states[dehum_thr].state | float(0) }}"
      temperature: "{{ states[temp_s].state | float(0) }}"
      humidity: "{{ states[hum_s].state | float(0) }}"
      discomfort_index: "{{ states[n_idx].state | float(0) }}"
      target_discomfort: "{{ states[tgt_idx].state   | float(0) }}"
      time_tra: !input input_time_tracker
  - choose:
      # 1) ê°€ìƒ ìŠ¤ìœ„ì¹˜ ON
      - conditions:
          - condition: trigger
            id: switch_on
        sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boost_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode_now
          - delay: "00:00:01"
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
          - delay: "00:00:01"
          - service: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input input_number_general_temperature
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input input_number_boost_threshold
                  - condition: template
                    value_template: >
                       {{ 0 < boost_dur}}
                sequence:
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: 18
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: POWER
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_boost_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ğŸ“£ ë¶€ìŠ¤íŠ¸ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, ê¸°ì¤€: {{ boosttemp }}Â°C
                  - delay:
                      minutes: !input input_number_boost_duration
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: auto
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} ğŸ“£ ë¶€ìŠ¤íŠ¸ ì¢…ë£Œ - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%, í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜ {{ discomfort_index }}DI
            default:
                - delay : "00:10:00"
                - service: input_boolean.turn_on
                  target:
                    entity_id: !input input_end_mode

      # 2) ì—ì–´ì»¨ ON (ì§ì ‘ ì¼œì§ ê°ì§€)
      - conditions:
          - condition: trigger
            id: ac_on
          - condition: state
            entity_id: !input input_boolean_switch
            state: "off"
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: !input input_boolean_switch
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boost_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_dry_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode_now
          - delay: "00:00:01"
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
          - delay: "00:00:01"
          - service: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input input_number_general_temperature
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input input_number_boost_threshold
                  - condition: template
                    value_template: >
                       {{ 0 < boost_dur}}
                sequence:
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: 18
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: POWER
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_boost_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ğŸ“£ ë¶€ìŠ¤íŠ¸ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, ê¸°ì¤€: {{ boosttemp }}Â°C
                  - delay:
                      minutes: !input input_number_boost_duration
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: auto
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} ğŸ“£ ë¶€ìŠ¤íŠ¸ ì¢…ë£Œ - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%, í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜ {{ discomfort_index }}DI
            default:
                - delay : "00:10:00"
                - service: input_boolean.turn_on
                  target:
                    entity_id: !input input_end_mode

                
      # 3) ì†¡í’ ON (ì§ì ‘ ì¼œì§ ê°ì§€)
      - conditions:
          - condition: trigger
            id: fan_on
          - condition: state
            entity_id: !input input_boolean_switch
            state: "off"
          - condition: state
            entity_id: !input input_end_mode
            state: "off"
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: !input input_boolean_switch
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boost_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_dry_mode
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_end_mode
          - delay: "00:00:01"
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
          - delay: "00:00:01"
          - service: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input input_number_general_temperature
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: numeric_state
                    entity_id: !input temperature_sensor
                    above: !input input_number_boost_threshold
                  - condition: template
                    value_template: >
                       {{ 0 < boost_dur}}
                sequence:
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: 18
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: POWER
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_boost_mode
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ğŸ“£ ë¶€ìŠ¤íŠ¸ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, ê¸°ì¤€: {{ dehumidity }}Â°C
                  - delay:
                      minutes: !input input_number_boost_duration
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: auto
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_on
                            target:
                              entity_id: !input input_end_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} ğŸ“£ ë¶€ìŠ¤íŠ¸ ì¢…ë£Œ- ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%, í˜„ì¬ ë¶ˆì¾Œì§€ìˆ˜ {{ discomfort_index }}DI
            default:
                - delay : "00:10:00"
                - service: input_boolean.turn_on
                  target:
                    entity_id: !input input_end_mode


  - choose:
      # 4. index_on íŠ¸ë¦¬ê±° ì‹œ ì‹œê°„ ì €ì¥
      - conditions:
          - condition: trigger
            id: index_on
        sequence:
          - service: input_datetime.set_datetime
            target:
              entity_id: !input input_time_tracker
            data:
              datetime: "{{ now().isoformat() }}"

      # 4-1. 1ë¶„ë§ˆë‹¤ í™•ì¸í•´ì„œ êº¼ì§€ê¸°
      - conditions:
          - condition: trigger
            id: time_change
          - condition: state
            entity_id: !input input_index_mode
            state: "on"
          - condition: template
            value_template: >
              {% set on_time = states[time_tra].state %}
              {% if on_time in ['unknown', 'unavailable', None] %}
                false
              {% else %}
                {{ (now() - as_local(as_datetime(on_time))).total_seconds() > 1200 }}
              {% endif %}
        sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_index_mode
          - service: input_text.set_value
            target:
              entity_id: !input input_log
            data:
              value: >
                {{ now().strftime('%m-%d %H:%M') }} ++ë¶ˆì¾Œì§€ìˆ˜ëª¨ë“œ ì‘ë™ 20ë¶„ê²½ê³¼ë˜ì–´ì–´ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.++


      # 5) ë¶ˆì¾Œì§€ìˆ˜Â·ìŠµë„ ë³€í™”
      - conditions:
          - condition: or
            conditions:
              - condition: trigger
                id: discomfort_change
              - condition: trigger
                id: over_time
          - condition: state
            entity_id: !input input_boolean_switch
            state: "on"
          - condition: state
            entity_id: !input input_boost_mode
            state: "off"
          - condition: state
            entity_id: !input input_index_mode
            state: "off"
          - condition: state
            entity_id: !input input_dry_mode
            state: "off"
          - condition: state
            entity_id: !input input_end_mode_now
            state: "off"
        sequence:
          - choose:
              #5-1 ì œìŠµ ë³‘í–‰ ì œìŠµ 10ë¶„+ëƒ‰ë°©5ë¶„ë¶„
              - conditions:
                  - condition: numeric_state
                    entity_id: !input humidity_sensor
                    above: !input input_number_dehumid_threshold
                sequence:
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_dry_mode
                  - delay: "00:00:01"
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: dry
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: high
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }}  ì œìŠµ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%, ê¸°ì¤€ìŠµë„: {{ dehumidity }}%
                  - delay: "00:10:00"
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: climate.set_hvac_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              hvac_mode: cool
                          - delay: "00:00:01"
                          - service: climate.set_fan_mode
                            target:
                              entity_id: !input climate_entity
                            data:
                              fan_mode: auto
                          - delay: "00:00:01"
                          - service: climate.set_temperature
                            target:
                              entity_id: !input climate_entity
                            data:
                              temperature: !input input_number_general_temperature
                          - delay: "00:05:00"
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_dry_mode
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }}  ì œìŠµ ì¢…ë£Œ - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%, ê¸°ì¤€ìŠµë„: {{ dehumidity }}%


              # 5-2 ë¶ˆì¾Œì§€ìˆ˜ ë†’ìŒ â†’ ëƒ‰ë°©10ë¶„
              - conditions:
                  - condition: template
                    value_template: >
                      {{ discomfort_index > (target_discomfort + tol) }}
                sequence:
                  - delay: "00:00:03"
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_index_mode
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: cool
                  - delay: "00:00:01"
                  - service: climate.set_temperature
                    target:
                      entity_id: !input climate_entity
                    data:
                      temperature: !input input_number_general_temperature
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: high
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ì§€ìˆ˜ ë†’ìŒ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, í˜„ì¬ ì§€ìˆ˜: {{ discomfort_index }}DI, ëª©í‘œì§€ìˆ˜ : {{ target_discomfort }}DI
                  - delay: "00:10:00"
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} ì§€ìˆ˜ ë†’ìŒ ì¢…ë£Œ - ì˜¨ë„: {{ temperature }}Â°C, í˜„ì¬ ì§€ìˆ˜: {{ discomfort_index }}DI, ëª©í‘œì§€ìˆ˜ : {{ target_discomfort }}DI
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_index_mode


              # 5-3 ë¶ˆì¾Œì§€ìˆ˜ ë‚®ìŒ â†’ ì†¡í’10ë¶„ 
              - conditions:
                  - condition: template
                    value_template: >
                      {{ discomfort_index < (target_discomfort - tol) }}
                sequence:
                  - delay: "00:00:03"
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_index_mode
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: fan_only
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: auto
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ì§€ìˆ˜ ë‚®ìŒ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, í˜„ì¬ ì§€ìˆ˜: {{ discomfort_index }}DI, ëª©í‘œì§€ìˆ˜ : {{ target_discomfort }}DI
                  - delay: "00:10:00"
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "on"
                        sequence:
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} ì§€ìˆ˜ ë‚®ìŒ ì¢…ë£Œ - ì˜¨ë„: {{ temperature }}Â°C, í˜„ì¬ ì§€ìˆ˜: {{ discomfort_index }}DI, ëª©í‘œì§€ìˆ˜ : {{ target_discomfort }}DI
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_index_mode
                          
                  
             # 5-4 ëª©í‘œ ë¶ˆì¾Œì§€ìˆ˜ ë²”ìœ„ë‚´ ì†¡í’ 10+ëƒ‰ë°©5
              - conditions:
                  - condition: state
                    entity_id: !input input_boolean_switch
                    state: "on"
                sequence:
                  - delay: "00:00:05"
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_index_mode
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: fan_only
                  - delay: "00:00:01"
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: auto
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ì§€ìˆ˜ ì ì • ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, í˜„ì¬ ì§€ìˆ˜: {{ discomfort_index }}DI, ëª©í‘œì§€ìˆ˜ : {{ target_discomfort }}DI
                  - delay: "00:10:00"
                  - choose:
                    - conditions:
                        - condition: state
                          entity_id: !input input_boolean_switch
                          state: "on"
                      sequence:
                        - service: climate.set_hvac_mode
                          target:
                            entity_id: !input climate_entity
                          data:
                            hvac_mode: cool
                        - delay: "00:00:01"
                        - service: climate.set_temperature
                          target:
                            entity_id: !input climate_entity
                          data:
                            temperature: !input input_number_general_temperature
                        - delay: "00:00:01"
                        - service: climate.set_fan_mode
                          target:
                            entity_id: !input climate_entity
                          data:
                            fan_mode: auto
                        - delay: "00:05:00"
                        - choose:
                          - conditions:
                              - condition: state
                                entity_id: !input input_boolean_switch
                                state: "on"
                            sequence:
                              - service: input_text.set_value
                                target:
                                  entity_id: !input input_log
                                data:
                                  value: >
                                    {{ now().strftime('%m-%d %H:%M') }} ì§€ìˆ˜ ì ì • ì¢…ë£Œ - ì˜¨ë„: {{ temperature }}Â°C, í˜„ì¬ ì§€ìˆ˜: {{ discomfort_index }}DI, ëª©í‘œì§€ìˆ˜ : {{ target_discomfort }}DI
                              - service: input_boolean.turn_off
                                target:
                                  entity_id: !input input_index_mode



      # 6) ì—ì–´ì»¨ OFF ê°ì§€ â†’ ìŠ¤ìœ„ì¹˜ ë™ê¸°í™” ë° ì¢…ë£Œ
      - conditions:
          - condition: trigger
            id: ac_off
        sequence:
          - delay: "00:00:01"
          - service: input_boolean.turn_off
            target:
              entity_id: !input input_boolean_switch




      # 67 ê°€ìƒ ìŠ¤ìœ„ì¹˜ OFF â†’ ì†¡í’ í›„ ì¢…ë£Œ
      - conditions:
          - condition: trigger
            id: switch_off
        sequence:
          - delay: "00:00:01"
          - choose:
              - conditions:
                  - condition: state
                    entity_id: !input input_end_mode
                    state: "on"
                  - condition: state
                    entity_id: !input input_end_mode_now
                    state: "off"
                  - condition: template
                    value_template: >
                       {{ 0 < shut_delay }}
                sequence:
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      hvac_mode: fan_only
                  - service: climate.set_fan_mode
                    target:
                      entity_id: !input climate_entity
                    data:
                      fan_mode: high
                  - service: input_boolean.turn_on
                    target:
                      entity_id: !input input_end_mode_now
                  - service: input_text.set_value
                    target:
                      entity_id: !input input_log
                    data:
                      value: >
                        {{ now().strftime('%m-%d %H:%M') }} ì¢…ë£Œëª¨ë“œ ì‹œì‘ - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%
                  - delay:
                      minutes: !input input_number_shutdown_delay
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: !input input_boolean_switch
                            state: "off"
                        sequence:
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_index_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_boost_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_dry_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_end_mode
                          - service: input_boolean.turn_off
                            target:
                              entity_id: !input input_end_mode_now
                          - delay: '00:00:01'
                          - service: climate.turn_off
                            target:
                              entity_id: !input climate_entity
                          - service: input_text.set_value
                            target:
                              entity_id: !input input_log
                            data:
                              value: >
                                {{ now().strftime('%m-%d %H:%M') }} ì¢…ë£Œëª¨ë“œì™„ë£Œ  ì‹œìŠ¤í…œì„ ì™„ì „íˆ ì¢…ë£Œí•©ë‹ˆë‹¤. - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%

            default:
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_boolean_switch
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_index_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_boost_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_dry_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_end_mode
                - service: input_boolean.turn_off
                  target:
                    entity_id: !input input_end_mode_now
                - delay: "00:00:01"
                - service: climate.turn_off
                  target:
                    entity_id: !input climate_entity
                - service: input_text.set_value
                  target:
                    entity_id: !input input_log
                  data:
                    value: >
                      {{ now().strftime('%m-%d %H:%M') }} ì¢…ë£Œëª¨ë“œì‘ë™í•˜ì§€ ì•ŠìŒ ì™„ì „íˆ ì¢…ë£Œí•©ë‹ˆë‹¤. - ì˜¨ë„: {{ temperature }}Â°C, ìŠµë„: {{ humidity }}%



                  
                  
                  
                  


mode: parallel
